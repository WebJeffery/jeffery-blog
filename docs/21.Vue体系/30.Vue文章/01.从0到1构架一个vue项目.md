---
author: 
  name: jeffery
  link: https://github.com/JefferyXZF
title: 从0到1构架一个 vue 项目
date: 2021-02-20 14:40:19
permalink: /pages/802eewdb71c59
categories: 
  - 前端
  - Vue文章
tags: 
  - 
---
# 从0到1构架一个 vue 项目

## vue-cli 脚手架搭建项目


用 [vue-cli](https://cli.vuejs.org/) 搭建项目，规范设计目录结构和框架

### 目录结构设计

- 视图页面放在 pages 或者 views 中
- 静态文件放在 static 中
- 资源文件放在 assets 中
- 样式文件放在 styles 中
- 辅助库放在 utils 中
- 配置文件可以放在 config 或者 constants 中
- vuex 的文件放在 stores 中，至于 getters, actions, mutation, modules 可以参考 [vuex](https://vuex.vuejs.org/zh/guide/) 的文档
- 路由文件放在 routes 中
- 共用组件放在 components 中
- 共享代码也可以使用shared作为目录
- 布局组件可以放在layouts目录中

### 项目用到的库

**UI框架**

- [Element](https://element.eleme.cn/#/zh-CN)
- [iView](https://www.iviewui.com/)
- [Ant Design Vue](https://antdv.com/docs/vue/introduce-cn/)
- ……

> 注：UI风格目前有 [Bookstrap](https://getbootstrap.com)、[Antd](https://ant.design/index-cn) 和 [Google Materials](https://material.io/design) 三种风格，在项目搭建时这也是一个很重要的技术选型。

**日期库**

- [dayjs](https://github.com/iamkun/dayjs/)
- [moment](https://momentjs.com/) （文件体积大）

**图表**

- [echarts](https://echarts.apache.org/zh/index.html)
- [highcharts](https://www.highcharts.com/)
- [AntV 可视化](https://antv.vision/zh)

**工具库**

- URL解析: [query-string](https://github.com/sindresorhus/query-string)、[path-to-reqexp](https://github.com/pillarjs/path-to-regexp)
- 实用方法：[lodash](https://lodash.com/)
- 接口库：[axios](https://github.com/axios/axios)、[isomorphic-fetch](https://github.com/matthew-andrews/isomorphic-fetch)、[fetch](https://github.com/matthew-andrews/isomorphic-fetch)
- Meta修改：[vue-meta](https://github.com/nuxt/vue-meta)
- cookie 操作：[js-cookie](https://github.com/js-cookie/js-cookie)
- 混淆ID: [hashids](https://github.com/vinkla/hashids)

**拖拽**

- [Vue.Draggable](https://github.com/SortableJS/Vue.Draggable)

### 规范设计

**接口设计**

- 封装 axios ，统一 api 调用风格和基本配置

**环境测试**

- 开放、测试和正式环境配置，一般不同环境接口基础路径不一样

### 代理和数据Mock

- [SPA](https://www.adcisolutions.com/knowledge/how-build-single-page-application-spa-vuejs) 页面开发通常都是配置代码来调用后端的接口数据，怎么配置可以参考@vue/cli文档。数据 Mock 主要用到一个 [mockjs](http://mockjs.com/) 


### 持续集成和部署

- 目前开源项目通常采用 [Travis](https://travis-ci.org/)，而一般公司内部项目通常采用 [Jenkins](https://www.jenkins.io/zh/) 来做持续集成，在部署上通常采用 [Docker](https://docs.docker.com/)，集群上使用 [KubeOperator](https://github.com/KubeOperator/KubeOperator) 来管理。

**API请求方式**

- 通常采用 [Restful](https://github.com/aisuhua/restful-api-design-references) 的方式来请求数据，也可以采用 [GraphQL](https://graphql.org/) 的方式来请求。如果采用Restfull的方式通常可以使用 axios, fetch api。GraphQL 可以使用 [Apollo Client](https://www.apollographql.com/docs/react/)

### 项目文档和组件测试文档

- 除了在项目根目录放一个 `README.MD` 文件外，通常还需要一些比如 `CHANGELOG.md`, `PLAD.md` 等文档，还有一些组件的使用文档，可以考虑使用 `styleguide`和 `storybook` 。

## 基于@vue/cli的选型

**ES6/7 or Typescript**

- 鉴于目前Typescript如此流行，很多流行的框架和库都采用其来写，IDE友好的智能提示、强类型结束等，在立项时是否考虑采用Typescript来写Vue项目

**Sass/Less/Stylus/PostCss ?**

- 由于 Vue 项目开发本身样式自带 scope，所以不需要像 React 那样去选 css-in-js 框架（目前在 React 最流行的是 styled-components），但是如果我们在Vue中采用JSX的方式来定义组件，是否考虑引入vue-styled-components这个库（年久失修，完全脱节React版了，但依然是Vue中最好的选择）。在Vue中sass, less, stylus可以在 `<style>` 标签中通过lang=""来指定，如果你想使用PostCss也可以的，就是要自己花点时间去折腾一下。

**关于代码规范和风格**

- [Prettier](https://prettier.io/) 
- [Google JavaScript Style Guide](https://google.github.io/styleguide/jsguide.html)
- [Airbnb JavaScript Style Guide](https://github.com/airbnb/javascript)
  

**关于测试**

- 单元测试 [Unit Testing](https://www.guru99.com/unit-testing-guide.html) 
- 端到端测试 [E2E Testing](https://www.katalon.com/resources-center/blog/end-to-end-e2e-testing/)

## 项目类型

### 小程序

- 框架限定使用 [Vue](https://vuejs.org/index.html), 例如 [mpvue](http://mpvue.com/)、[uni-app](https://uniapp.dcloud.io/)

### H5 页面

- 微信页面、[Webview](https://developers.weixin.qq.com/miniprogram/dev/component/web-view.html) 中的 H5 页面

### PC 官网

- 主要是用来展示企业信息、产品，对交互、体验有一定的要求，会有一些炫酷的动画效果。还有就是官网有可能需要采用 SSR（比如 [Vue](https://vuejs.org/index.html) 的 [Nuxt.js](https://nuxtjs.org/)）来做，来确定良好的 SEO。

### 后台管理系统

- 后台管理系统主要功能在于数据的配置、权限的控制、数据报表的展示、日志功能等。通常又叫 CMS，OA


### Native开发

- 通常就是指用前端技术去开发 PC 应用、APP 应用，比如 [Weex](https://weex.apache.org/zh/guide/introduction.html), [Electron](https://www.electronjs.org/)。


## 版本管理

**Git Flow**

- 在开发环境的区分上通常分为生产（线上）环境、预发布环境、开发环境，有的还有什么沙盒环境，很多做得好的公司基于Docker前后端都可以根据每一个commit来发布。

- 有时候不想把有些代码提交上去，除了选择性提交单个文件外，还有使用git的stash功能，此外如果使用Webstorm可还可以使用其提供的Changelist来缓存修改，切换分支。

**Git Comit**

项目提交的描述如果没有一定的规范，随性而为的话，就会让其它人误解。通常提交采用英文作为描述，可以多行文字。在社区中有很多流行的方案(比如 [Conventional Commit](https://www.conventionalcommits.org/en/v1.0.0/))，更多的是采用Angular的方式

**Change Log**

如果采用了社区统一的commit方式，那么我们就可以基于提交来生成变更记录，在每一次版本发布时自动关联Jira中的Issue。

**版本号生成**

这个通常是按照 [Semantic Versioning](https://semver.org/) 的规范来打tag，具休怎么做可以自行尝试

在项目中通常使用gitHooks和husky这二个node包来配置上面提到的这些。在git钩子中我们在每次提交、push前跑一次单元测试、代码覆盖率。前端代码覆盖率一般来说没有必要加，不然很痛苦。

下面是package.json文件中相关的配置示例（试验性代码）

```json
{
  "name": "your-project-name",
  "version": "0.1.0",
  "scripts": {
    "clean": "rm -rf node_modules",
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build",
    "lint": "vue-cli-service lint --no-fix",
    "stylelint": "stylelint src/**/*.{scss,css,less,css,vue,jsx} --fix",
    "eslint": "eslint --ext .js,.jsx,.vue src --fix",
    "changelog": "conventional-changelog -p angular -i CHANGELOG.md -s -r 0"
  },
  "repository": {
    "type": "git",
    "url": "http://gitlab.transsion.com/mi/mi-bigdata-admin.git"
  },
  "dependencies": {},
  "devDependencies": {
    "@commitlint/cli": "^8.1.0",
    "@commitlint/config-conventional": "^8.1.0",
    "babel-eslint": "^10.0.1",
    "conventional-changelog-cli": "^2.0.23",
    "eslint": "^6.2.1",
    "eslint-plugin-vue": "^5.2.3",
    "husky": "^3.0.4",
    "lint-staged": "^9.2.3",
    "stylelint": "^10.1.0",
    "stylelint-config-standard": "^18.3.0",
    "stylelint-scss": "^3.9.4",
  },
  "gitHooks": {
    "pre-commit": "lint-staged"
  },
  "lint-staged": {
    "*.{js,vue}": [
      "vue-cli-service lint",
      "eslint --fix --ext .js,.vue src",
      "git add"
    ],
    "*.{css,scss,less,vue}": [
      "stylelint --fix",
      "git add"
    ]
  },
  "husky": {
    "hooks": {
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
  }
}


```

## 通用配置

 **编辑器配置**：`.editorconfig`

这里最重要的是缩进方式，及Tab大小，建议2个空格作用缩进。

```text
# https://editorconfig.org
root = true

[*]
charset = utf-8
indent_style = space
indent_size = 2
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true

[*.md]
insert_final_newline = false
trim_trailing_whitespace = false
```

 **Git忽略文件配置**: `.gitignore`

这里的配置决定了哪些文件会被版本控制所忽略

```text
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js

# testing
/coverage

# production
/build

# misc
.DS_Store
.env.local
.env.development.local
.env.test.local
.env.production.local

npm-debug.log*
yarn-debug.log*
yarn-error.log*

# editor
/.idea

```
**Eslint配置**: `.eslintrc.js`，`.eslintignore` 等

```json
module.exports = {
  root: true,
  env: {
    node: true
  },
  extends: ["plugin:vue/strongly-recommended"],
  rules: {
    "no-console": process.env.NODE_ENV === "production" ? "error" : "off",
    "no-debugger": process.env.NODE_ENV === "production" ? "error" : "off",
    // 不加分号
    "semi": [0],
    // 不能有未定义的变量
    "no-undef": 1,
    // 不能有声明后未被使用的变量或参数
    "no-unused-vars":[2, {
      "vars": "local",
      "args": "none"
    }],
    // 禁止修改const声明的变量
    "no-const-assign": 2,
    // 函数参数不能重复
    "no-dupe-args": 2,
    // 如果if语句里面有return,后面不能跟else语句
    "no-else-return": 2,
    // 块语句中的内容不能为空
    "no-empty": 2,
    // 禁止对null使用==或!=运算符
    "no-eq-null": 2,
    // 禁止扩展native对象
    "no-extend-native": 2,
    // 禁止不必要的函数绑定
    "no-extra-bind": 2,
    // 禁止非必要的括号
    "no-extra-parens": 2,
    // 禁止多余的冒号
    "no-extra-semi":2,
    // 禁止省略浮点数中的0 .5 3.
    "no-floating-decimal": 2,
    // 禁止行内备注
    "no-inline-comments": 0,
    // 不能有不规则的空格
    "no-irregular-whitespace": 2,
    // 不能用多余的空格
    "no-multi-spaces": 1,
    // 禁止重复声明变量
    "no-redeclare": 2,
    // 禁止使用javascript:void(0)
    "no-script-url": 0,
    // 禁止稀疏数组， [0,,2]
    "no-sparse-arrays": 2,
    // 禁止使用三目运算符
    "no-ternary": 0,
    // 一行结束后面不要有空格
    "no-trailing-spaces": 1,
    // 标识符不能以_开头或结尾
    "no-underscore-dangle": 1,
    // 是否允许非空数组里面有多余的空格
    "array-bracket-spacing": [2, "never"],
    // 箭头函数用小括号括起来
    "arrow-parens": 0,
    // =>的前/后括号
    "arrow-spacing": 0,
    // 块语句中使用var
    "block-scoped-var": 0,
    // 逗号风格，换行时在行首还是行尾
    "comma-style": [2, "last"],
    // 避免不必要的方括号
    "dot-notation": [0, { "allowKeywords": true }],
    // 必须使用全等
    "eqeqeq": 2,
    // 对象字面量中冒号的前后空格
    "key-spacing": [0, {
      "beforeColon": false,
      "afterColon": true
    }],
    // 变量声明后是否需要空一行
    "newline-after-var": 0,
    // 引号类型 `` "" ''
    "quotes": [1, "single"],
    // 变量声明时排序
    "sort-vars": 0,
    // 禁止比较时使用NaN，只能用isNaN()
    "use-isnan": 2,
    //jsx中使用单引号
    "jsx-quotes": ["error", "prefer-single"],
    // 单个组件无内容自结尾
    "vue/html-self-closing": ["error", {
      "html": {
        "void": "always",
        "normal": "always",
        "component": "always"
      },
      "svg": "always",
      "math": "always"
    }],
    // 设置html缩进
    "vue/html-indent": ["error", 2, {
      "attribute": 2,
      "baseIndent": 1,
      "closeBracket": 0,
      "alignAttributesVertically": false,
      "ignores": []
    }],
    // 属性顺序
    "vue/attributes-order": 1,
    // 注释前面需要添加空格
    "spaced-comment": ["error", "always", { "exceptions": ["-", "+"] }],
    // html属性赋值等号左右不能有空格
    "vue/no-spaces-around-equal-signs-in-attribute": ["error"],
    // 强制prop以驼峰命名
    "vue/prop-name-casing": ["error", "camelCase"],
    // 移除多余不使用的空格
    "vue/no-multi-spaces": ["error", {
      "ignoreProperties": false
    }],
    // html结尾 >
    "vue/html-closing-bracket-newline": ["error", {
      "singleline": "never",
      "multiline": "never"
    }],
    // 属性每行数量
    "vue/max-attributes-per-line": ["error", {
      // 一行最多3个属性
     "singleline": 3,
      "multiline": {
        "max": 1,
        "allowFirstLine": true
      }
    }],
    // 单行html元素内容是否换行
    "vue/singleline-html-element-content-newline": ["error", {
      "ignoreWhenNoAttributes": true,
      "ignoreWhenEmpty": true,
      "ignores": [
        "pre",
        "textarea",
        "span",
        "i",
        "label",
        "el-button",
        "el-radio",
        "el-checkbox",
        "el-link",
        "el-tab-pane",
        "el-dropdown-item",
        "el-step",
        "el-table-column",
        "el-option"
      ]
    }]
  },
  parserOptions: {
    parser: "babel-eslint"
  }
};
```

**PostCss 配置**: `postcss.config.js`

这个文件自动生成，里面的内容就是指定 `autoprefixer` 兼容配置

**Babel配置**:  `babel.config.js`

主要是配置 `Babel` 的 `plugins`、`presets` 和 `parse` 等

**Webpack** 配置：`webpack.config.js`

```javascript
'use strict'
const path = require('path')

function resolve (dir) {
  return path.join(__dirname, '.', dir)
}

module.exports = {
  context: path.resolve(__dirname, './'),
  resolve: {
    extensions: ['.js', '.vue', '.json'],
    alias: {
      '@': resolve('src'),
      '_c': resolve('src/components')
    }
  }
}
```



## 参考资料

- [Front-End Coding Guidelines](https://guide.aotu.io/index.html)
- [JS最佳实践](https://wdd.js.org/js-best-practices/#/)